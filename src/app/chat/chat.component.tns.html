<Page.actionBar>
    <ActionBar title="{{ chatName }}" android:horizontalAlignment="center" ios:horizontalAlignment="center">
    	<NavigationButton text="Go Back" android.systemIcon="ic_menu_back" (tap)="onNavBtnTap()"></NavigationButton>
	    <ActionItem (tap)="onLeave()"
	      ios.systemIcon="9" ios.position="right"
	      text="Leave chat" android.position="popup"></ActionItem>
    </ActionBar>
</Page.actionBar>

<StackLayout>
    <ListView height="90%" margin-bottom="50" padding="5" #messageList [items]="messages" separatorColor="transparent" (setupItemView)="setupItemView($event)">
        <ng-template let-item="item" let-i="index" let-mine="mine" let-theirs="theirs">
            <GridLayout columns="*" rows="auto" class="message-grid">
                <StackLayout orientation="horizontal" [horizontalAlignment]="align(item)">
                    <Image [visibility]="item.visibility" class="author-img" stretch="aspectFill" height="40" width="40" verticalAlignment="top" [src]="item.chatMessage.pfpSource" col="1"></Image>
                    <Label [text]='item.chatMessage.message' [class.mine]="mine" [class.theirs]="theirs" textWrap="true" verticalAlignment="top"></Label>
                </StackLayout>
            </GridLayout>
        </ng-template>
    </ListView>

    <StackLayout #chatbox height="10%" class="chat-box-layout">
    	<ScrollView height="100%">
	        <GridLayout columns="*,auto" style="padding: 10">
	            <TextView #textfield height="auto" hint="Start a message" class="chat-text-field" row="0" col="0" [(ngModel)]="message"></TextView>
	            <Button #btn class="chat-button" row="0" col="1" text="send" (tap)=sendMessage()></Button>
	        </GridLayout>
	    </ScrollView>
    </StackLayout>

</StackLayout>